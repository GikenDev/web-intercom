<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/MixerUI/MixerUI.css">
    <style>
      html {
        background-color: hsl(0, 0%, 10%);
      }
      #mixer-view {
        width: 700px;
        margin-top: 20px;
      }
    </style>
    <script type="module">
      /**
       * Test for `MixerUI.js`
       *
       * Test steps:
       *   1. Execute `main.js` (in same directory) with Deno - `deno run --allow-net --allow-read main.js`
       *   2. Access to `http://localhost:8000/Try_MixerUI.html` with browser
       *   3. Open JavaScript console
       *   4. Click test control buttons
       *   5. Check display view or console
       *
       * Test cases:
       *   - Can create lanes
       *   - Can delete lanes
       *   - Can set any value to fader
       *   - Can set any value to meter
       *   - Can set/unset callback function of fader moved
       *   - Can move lane fader by left/right key
       *   - Can move active lane (to move fader) by up/down key
       *
       * @author aKuad
       */
      import { MixerUI } from "/static/MixerUI/MixerUI.js";

      window.addEventListener("load", () => {
        const mixer_ui = new MixerUI(document.getElementById("mixer-view"));

        mixer_ui.set_callback_on_fader_moved(part_print_id_value);

        for(let i = 0; i < 3; i++) {
          document.getElementById(`button-create-lane-${i}` ).addEventListener("click", () => mixer_ui.create_lane(`LA${i}`, i));
          document.getElementById(`button-delete-lane-${i}` ).addEventListener("click", () => mixer_ui.delete_lane(i));
          document.getElementById(`button-random-fader-${i}`).addEventListener("click", () => mixer_ui.set_fader_value(i, part_random_255()));
          document.getElementById(`button-random-meter-${i}`).addEventListener("click", () => mixer_ui.set_meter_value(i, part_random_255()));
        }

        document.getElementById("button-callback-enable" ).addEventListener("click", () => mixer_ui.set_callback_on_fader_moved(part_print_id_value));
        document.getElementById("button-callback-disable").addEventListener("click", () => mixer_ui.set_callback_on_fader_moved(null));
      });

      function part_random_255() {
        return Math.floor(Math.random() * 255);
      }

      function part_print_id_value(lane_id, moved_value) {
        console.log(`$lane_id: ${lane_id}, moved_value: ${moved_value}`);
      }
    </script>
  </head>

  <body>
    <p>
      <button id="button-create-lane-0">Create lane 0</button>
      <button id="button-delete-lane-0">Delete lane 0</button>
      <button id="button-random-fader-0">Random fader 0</button>
      <button id="button-random-meter-0">Random meter 0</button><br>
    </p>
    <p>
      <button id="button-create-lane-1">Create lane 1</button>
      <button id="button-delete-lane-1">Delete lane 1</button>
      <button id="button-random-fader-1">Random fader 1</button>
      <button id="button-random-meter-1">Random meter 1</button><br>
    </p>
    <p>
      <button id="button-create-lane-2">Create lane 2</button>
      <button id="button-delete-lane-2">Delete lane 2</button>
      <button id="button-random-fader-2">Random fader 2</button>
      <button id="button-random-meter-2">Random meter 2</button>
    </p>
    <hr>
    <p>
      <button id="button-callback-enable">Enable callback</button>
      <button id="button-callback-disable">Disable callback</button>
    </p>
    <hr>
    <div id="mixer-view"></div>
  </body>
</html>
